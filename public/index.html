<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Stateful OSC Relay - WebUI</title>

		<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css" rel="stylesheet">
		<style>

		.main-nav {
			padding-top: 20px;
		}

		@media (min-width: 768px) {
			.main-nav {
				padding-top: 100px;
			}
		}

		.tab {
			display: none;
		}

		.tab.active {
			display: block;
		}

		.guest-table {
			table-layout: fixed;
		}

		.guest-table .ipv4 { width: 200px; }
		.guest-table .source { width: 100px; }

		.guest-table .no-guests {
			font-style: italic;
			text-align: center;
		}

		</style>


		<!--script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script-->
		<script src="//code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			$(function() {
				var
					$tbody = $('.guest-table tbody'),
					$nav = $('.main-nav'),
					$tabs = $('.tab'),
					sourceNames = {z: 'Zeroconf', s: 'Static'};

				// Navigation
				$nav.on('click', 'a', function() {
					var
						$a = $(this),
						target = $(this).attr('href').substr(1);

					navigateTo(target);
				});

				function navigateTo(target)
				{
					// shift focus on nav buttons
					$nav
						.find('li')
						.removeClass('active')
						.filter('.nav-'+target)
						.addClass('active');

					// shift focus on active tab
					$tabs
						.removeClass('active')
						.filter('.'+target+'-tab')
						.addClass('active');
				}

				if(window.location.hash)
				{
					var target = window.location.hash.substr(1);
					navigateTo(target);
				}



				// Socket communication
				var socket = io.connect(window.location.protocol+'//'+window.location.host, {
					'reconnection limit': 5000,
					'sync disconnect on unload': true
				});

				socket.on('update', function(reason, bundle) {
					console.log('update because of', reason, bundle);

					// clean and re-fill guest table
					$tbody.find('> tr').remove();
					if(bundle.g.length > 0)
					{
						for(var i = 0; i < bundle.g.length; i++) {
							var guest = bundle.g[i];

							$('<tr>')
								.appendTo($tbody)
								.append($('<td>').text(guest.n))
								.append($('<td>').text(guest.a + ':' + guest.p))
								.append($('<td>').text(  sourceNames[guest.s]  ));
						};
					}
					else {
						$('<tr>')
							.appendTo($tbody)
							.append(
								$('<td colspan="3" class="no-guests">')
									.text('Currently no guests are visible via Zeroconf. Maybe they need to be configured as static guests?')
							)
					}
				});
			});
		</script>
	</head>

	<body>
		<div class="container">
			<div class="row">


				<div class="col-sm-3 main-nav">
					<ul class="nav nav-pills nav-stacked">
						<li class="nav-guests active"><a href="#guests">Guests</a></li>
						<li class="nav-presets"><a href="#presets">Presets</a></li>
						<li class="nav-config"><a href="#config">Config</a></li>
						<li class="nav-messages"><a href="#messages">Message I/O</a></li>
						<li class="nav-log"><a href="#log">Log</a></li>
					</ul>
				</div><!-- col-sm-3 main-nav -->


				<div class="col-sm-9 guests-tab tab active">

					<h2>Guests</h2>
					<table class="table table-striped guest-table">
						<thead>
							<tr>
								<th class="name">Guest Name</th>
								<th class="ipv4">IPv4 Adress</th>
								<th class="source">Source</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>

				</div><!-- col-sm-9 guests-tab tab active -->


				<div class="col-sm-9 presets-tab tab">

					<h2>Presets</h2>
					<p>tbd.</p>

				</div><!-- col-sm-9 presets-tab tab -->


			</div><!-- row -->
		</div><!-- container -->
	</body>
</html>
